sift4Gfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_SIFT4G_pred, ignore.case = TRUE),]
lrtfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_LRT_pred, ignore.case = TRUE),]
muttfilter <- thresholdfilter[grep("A|D", thresholdfilter$dbNSFP_MutationTaster_pred, ignore.case = TRUE),]
pphdivfilter <- thresholdfilter[grep("D|P", thresholdfilter$dbNSFP_Polyphen2_HDIV_pred, ignore.case = TRUE),]
pphvarfilter <- thresholdfilter[grep("D|P", thresholdfilter$dbNSFP_Polyphen2_HVAR_pred, ignore.case = TRUE),]
metasvmfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_MetaSVM_pred, ignore.case = TRUE),]
metalrfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_MetaLR_pred, ignore.case = TRUE),]
mcapfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_M_CAP_pred, ignore.case = TRUE),]
primateaifilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_PrimateAI_pred, ignore.case = TRUE),]
fathmmfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_FATHMM_pred, ignore.case = TRUE),]
proveanfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_PROVEAN_pred, ignore.case = TRUE),]
mutafilter <- thresholdfilter[grep("H|M", thresholdfilter$dbNSFP_MutationAssessor_pred, ignore.case = TRUE),]
aloftfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_Aloft_pred, ignore.case = TRUE),]
deogenfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_DEOGEN2_pred, ignore.case = TRUE),]
merged <- rbind(siftfilter, sift4Gfilter,lrtfilter,muttfilter,pphdivfilter,pphvarfilter,metasvmfilter,metalrfilter,mcapfilter,primateaifilter,fathmmfilter,proveanfilter,mutafilter,aloftfilter,deogenfilter)
merged <- unique(merged)
names(merged)[names(merged)== "ANN.0..GENE."] <- "Hugo_Symbol"
names(merged)[names(merged)== "CHROM"] <- "Chromosome"
names(merged)[names(merged)== "POS"] <- "Start_Position"
for (i in 1:nrow(merged)) {
merged$End_Position[i] <- merged$Start_Position[i] + max(unlist(lapply(as.list(unlist(strsplit(merged$ALT[i], ","))), nchar))) - nchar(merged$REF[i])
startpos <- merged$Start_Position[i]
endpos <- merged$End_Position[i]
if(endpos-startpos > 0) {
merged$Variant_Type[i] <- "INS"
} else if (endpos-startpos < 0) {
merged$Variant_Type[i] <- "DEL"
} else {
merged$Variant_Type[i] <- "SNP"
}
}
a <- Auth(platform = "cavatica", token = "d8554e151de14d9b998af569994f4bfb")
p <- a$project(id = "gaonkark/sv-test")
file <- p$file(name = basename(input_txt), exact = TRUE)
merged$Tumor_Sample_Barcode <- file$meta()$`Kids First Biospecimen ID`
merged <- cbind( merged[,(1:3)], merged[,(103:105)], merged[,4:102] )
names(merged)[names(merged)== "ANN.0..EFFECT"] <- "Variant_Classification"
names(merged)[names(merged)== "REF"] <- "Reference_Allele"
names(merged)[names(merged)== "ALT"] <- "Tumor_Seq_Allele2"
merged <- merged %>% separate_rows(Variant_Classification, sep = "&")
View(thresholdfilter)
#read input
input <- read.delim(input_txt, sep = "\t", comment.char = "#", stringsAsFactors = F)
df <- as.data.frame(input)
View(input)
View(df)
rm(input)
#pass filter
passfilter <- df[grep("pass", df$FILTER, ignore.case = T),]
View(passfilter)
rm(df)
genes <- read.delim(input_genes, header = F, sep = "", stringsAsFactors = F)
#check against genes
genefilter <- passfilter[is.element(passfilter$ANN.0..GENE.,genes$V1), ]
input_genes <- "predisposition-genes.txt"
genes <- read.delim(input_genes, header = F, sep = "", stringsAsFactors = F)
#check against genes
genefilter <- passfilter[is.element(passfilter$ANN.0..GENE.,genes$V1), ]
View(genefilter)
qfilter <- genefilter[grep("high|moderate",
genefilter$ANN.0..IMPACT., ignore.case = T),]
rm(passfilter)
View(qfilter)
#check against threshold
qfilter[71:102] <- sapply(qfilter[71:102],as.numeric)
warnings()
qfilter <- genefilter[grep("high|moderate",
genefilter$ANN.0..IMPACT., ignore.case = T),]
#check against threshold
qfilter[,71:102] <- sapply(qfilter[,71:102],as.numeric)
qfilter <- genefilter[grep("high|moderate",
genefilter$ANN.0..IMPACT., ignore.case = T),]
#check against threshold
qfilter[,71:102] <- sapply(qfilter[,71:102],as.numeric())
#check against threshold
qfilter[,71:102] <- sapply(qfilter[,71:102], as.numeric)
View(qfilter)
thresholdfilter <- qfilter[apply((qfilter[71:102] <= threshold), 1, all),]
threshold <- 0.001
thresholdfilter <- qfilter[apply((qfilter[71:102] <= threshold), 1, all),]
View(thresholdfilter)
thresholdfilter <- qfilter[apply((qfilter[,71:102] <= threshold) | (is.na(qfilter[,71:102])), 1, all),]
View(thresholdfilter)
rm(genefilter)
rm(qfilter)
rm(genes)
#keep SIFT predictions
siftfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_SIFT_pred, ignore.case = TRUE),]
sift4Gfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_SIFT4G_pred, ignore.case = TRUE),]
lrtfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_LRT_pred, ignore.case = TRUE),]
muttfilter <- thresholdfilter[grep("A|D", thresholdfilter$dbNSFP_MutationTaster_pred, ignore.case = TRUE),]
pphdivfilter <- thresholdfilter[grep("D|P", thresholdfilter$dbNSFP_Polyphen2_HDIV_pred, ignore.case = TRUE),]
pphvarfilter <- thresholdfilter[grep("D|P", thresholdfilter$dbNSFP_Polyphen2_HVAR_pred, ignore.case = TRUE),]
metasvmfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_MetaSVM_pred, ignore.case = TRUE),]
metalrfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_MetaLR_pred, ignore.case = TRUE),]
mcapfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_M_CAP_pred, ignore.case = TRUE),]
primateaifilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_PrimateAI_pred, ignore.case = TRUE),]
fathmmfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_FATHMM_pred, ignore.case = TRUE),]
proveanfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_PROVEAN_pred, ignore.case = TRUE),]
mutafilter <- thresholdfilter[grep("H|M", thresholdfilter$dbNSFP_MutationAssessor_pred, ignore.case = TRUE),]
aloftfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_Aloft_pred, ignore.case = TRUE),]
deogenfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_DEOGEN2_pred, ignore.case = TRUE),]
merged <- rbind(siftfilter, sift4Gfilter,lrtfilter,muttfilter,pphdivfilter,pphvarfilter,metasvmfilter,metalrfilter,mcapfilter,primateaifilter,fathmmfilter,proveanfilter,mutafilter,aloftfilter,deogenfilter)
merged <- unique(merged)
names(merged)[names(merged)== "ANN.0..GENE."] <- "Hugo_Symbol"
names(merged)[names(merged)== "CHROM"] <- "Chromosome"
names(merged)[names(merged)== "POS"] <- "Start_Position"
for (i in 1:nrow(merged)) {
merged$End_Position[i] <- merged$Start_Position[i] + max(unlist(lapply(as.list(unlist(strsplit(merged$ALT[i], ","))), nchar))) - nchar(merged$REF[i])
startpos <- merged$Start_Position[i]
endpos <- merged$End_Position[i]
if(endpos-startpos > 0) {
merged$Variant_Type[i] <- "INS"
} else if (endpos-startpos < 0) {
merged$Variant_Type[i] <- "DEL"
} else {
merged$Variant_Type[i] <- "SNP"
}
}
a <- Auth(platform = "cavatica", token = "d8554e151de14d9b998af569994f4bfb")
p <- a$project(id = "gaonkark/sv-test")
file <- p$file(name = basename(input_txt), exact = TRUE)
merged$Tumor_Sample_Barcode <- file$meta()$`Kids First Biospecimen ID`
merged <- cbind( merged[,(1:3)], merged[,(103:105)], merged[,4:102] )
names(merged)[names(merged)== "ANN.0..EFFECT"] <- "Variant_Classification"
names(merged)[names(merged)== "REF"] <- "Reference_Allele"
names(merged)[names(merged)== "ALT"] <- "Tumor_Seq_Allele2"
merged <- merged %>% separate_rows(Variant_Classification, sep = "&")
View(merged)
clinvarfilter <- thresholdfilter[grep("pathogenic", thresholdfilter$dbNSFP_clinvar_clnsig, ignore.case = T)]
clinvarfilter <- thresholdfilter[grep("pathogenic", thresholdfilter$dbNSFP_clinvar_clnsig, ignore.case = T),]
merged <- rbind(clinvarfilter, siftfilter, sift4Gfilter,lrtfilter,muttfilter,pphdivfilter,pphvarfilter,metasvmfilter,metalrfilter,mcapfilter,primateaifilter,fathmmfilter,proveanfilter,mutafilter,aloftfilter,deogenfilter)
rm(merged)
merged <- rbind(clinvarfilter, siftfilter, sift4Gfilter,lrtfilter,muttfilter,pphdivfilter,pphvarfilter,metasvmfilter,metalrfilter,mcapfilter,primateaifilter,fathmmfilter,proveanfilter,mutafilter,aloftfilter,deogenfilter)
merged <- unique(merged)
names(merged)[names(merged)== "ANN.0..GENE."] <- "Hugo_Symbol"
names(merged)[names(merged)== "CHROM"] <- "Chromosome"
names(merged)[names(merged)== "POS"] <- "Start_Position"
for (i in 1:nrow(merged)) {
merged$End_Position[i] <- merged$Start_Position[i] + max(unlist(lapply(as.list(unlist(strsplit(merged$ALT[i], ","))), nchar))) - nchar(merged$REF[i])
startpos <- merged$Start_Position[i]
endpos <- merged$End_Position[i]
if(endpos-startpos > 0) {
merged$Variant_Type[i] <- "INS"
} else if (endpos-startpos < 0) {
merged$Variant_Type[i] <- "DEL"
} else {
merged$Variant_Type[i] <- "SNP"
}
}
a <- Auth(platform = "cavatica", token = "d8554e151de14d9b998af569994f4bfb")
p <- a$project(id = "gaonkark/sv-test")
file <- p$file(name = basename(input_txt), exact = TRUE)
merged$Tumor_Sample_Barcode <- file$meta()$`Kids First Biospecimen ID`
merged <- cbind( merged[,(1:3)], merged[,(103:105)], merged[,4:102] )
names(merged)[names(merged)== "ANN.0..EFFECT"] <- "Variant_Classification"
names(merged)[names(merged)== "REF"] <- "Reference_Allele"
names(merged)[names(merged)== "ALT"] <- "Tumor_Seq_Allele2"
merged <- merged %>% separate_rows(Variant_Classification, sep = "&")
# merged$Variant_Classification[merged$Variant_Classification == "missense_variant"] <- "Missense_Mutation"
# merged$Variant_Classification[merged$Variant_Classification == "protein_protein_contact"] <- "Missense_Mutation"
# merged$Variant_Classification[merged$Variant_Classification == "stop_gained"] <- "Nonsense_Mutation"
# merged$Variant_Classification[merged$Variant_Classification == "start_lost"] <- "Translational_Start_Site"
# merged$Variant_Classification[merged$Variant_Classification == "splice_donor_variant"] <- "Splice_Site"
# merged$Variant_Classification[merged$Variant_Classification == "splice_acceptor_variant"] <- "Splice_Site"
# merged$Variant_Classification[(merged$Variant_Classification == "conservative_inframe_deletion") | (merged$Variant_Classification == "disruptive_inframe_deletion")] <- "In_Frame_Del"
# merged$Variant_Classification[(merged$Variant_Classification == "conservative_inframe_insertion") | (merged$Variant_Classification == "disruptive_inframe_insertion")] <- "In_Frame_Ins"
# merged$Variant_Classification[(merged$Variant_Classification == "frameshift_variant") & (merged$Variant_Type == "INS")] <- "Frame_Shift_Ins"
# merged$Variant_Classification[(merged$Variant_Classification == "frameshift_variant") & (merged$Variant_Type == "DEL")] <- "Frame_Shift_Del"
a <- merged
input_txt <- "290c0268-1e2e-4eb0-86b8-c3ae84e89c54.snpeff.dbnsfp_anno.txt"
input_genes <- "predisposition-genes.txt"
threshold <- 0.001
output_txt <- sub(".snpEff.vcf.dbnsfp_anno.txt",".snpEff.dbnsfp_anno.filt.txt", basename(input_txt))
print(output_txt)
#read input
input <- read.delim(input_txt, sep = "\t", comment.char = "#", stringsAsFactors = F)
print("input txt read")
df <- as.data.frame(input)
print("input txt converted to df")
rm(input)
#pass filter
passfilter <- df[grep("pass", df$FILTER, ignore.case = T),]
rm(df)
genes <- read.delim(input_genes, header = F, sep = "", stringsAsFactors = F)
#check against genes
genefilter <- passfilter[is.element(passfilter$ANN.0..GENE.,genes$V1), ]
rm(passfilter)
qfilter <- genefilter[grep("high|moderate",
genefilter$ANN.0..IMPACT., ignore.case = T),]
#check against threshold
qfilter[71:102] <- sapply(qfilter[71:102],as.numeric)
thresholdfilter <- qfilter[apply((qfilter[,71:102] <= threshold) | (is.na(qfilter[,71:102])), 1, all),]
rm(genefilter)
rm(qfilter)
rm(genes)
#keep SIFT predictions
siftfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_SIFT_pred, ignore.case = TRUE),]
sift4Gfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_SIFT4G_pred, ignore.case = TRUE),]
lrtfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_LRT_pred, ignore.case = TRUE),]
muttfilter <- thresholdfilter[grep("A|D", thresholdfilter$dbNSFP_MutationTaster_pred, ignore.case = TRUE),]
pphdivfilter <- thresholdfilter[grep("D|P", thresholdfilter$dbNSFP_Polyphen2_HDIV_pred, ignore.case = TRUE),]
pphvarfilter <- thresholdfilter[grep("D|P", thresholdfilter$dbNSFP_Polyphen2_HVAR_pred, ignore.case = TRUE),]
metasvmfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_MetaSVM_pred, ignore.case = TRUE),]
metalrfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_MetaLR_pred, ignore.case = TRUE),]
mcapfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_M_CAP_pred, ignore.case = TRUE),]
primateaifilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_PrimateAI_pred, ignore.case = TRUE),]
fathmmfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_FATHMM_pred, ignore.case = TRUE),]
proveanfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_PROVEAN_pred, ignore.case = TRUE),]
mutafilter <- thresholdfilter[grep("H|M", thresholdfilter$dbNSFP_MutationAssessor_pred, ignore.case = TRUE),]
aloftfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_Aloft_pred, ignore.case = TRUE),]
deogenfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_DEOGEN2_pred, ignore.case = TRUE),]
clinvarfilter <- thresholdfilter[grep("pathogenic", thresholdfilter$dbNSFP_clinvar_clnsig, ignore.case = T),]
merged <- rbind(clinvarfilter, siftfilter, sift4Gfilter,lrtfilter,muttfilter,pphdivfilter,pphvarfilter,metasvmfilter,metalrfilter,mcapfilter,primateaifilter,fathmmfilter,proveanfilter,mutafilter,aloftfilter,deogenfilter)
merged <- unique(merged)
names(merged)[names(merged)== "ANN.0..GENE."] <- "Hugo_Symbol"
names(merged)[names(merged)== "CHROM"] <- "Chromosome"
names(merged)[names(merged)== "POS"] <- "Start_Position"
for (i in 1:nrow(merged)) {
merged$End_Position[i] <- merged$Start_Position[i] + max(unlist(lapply(as.list(unlist(strsplit(merged$ALT[i], ","))), nchar))) - nchar(merged$REF[i])
startpos <- merged$Start_Position[i]
endpos <- merged$End_Position[i]
if(endpos-startpos > 0) {
merged$Variant_Type[i] <- "INS"
} else if (endpos-startpos < 0) {
merged$Variant_Type[i] <- "DEL"
} else {
merged$Variant_Type[i] <- "SNP"
}
}
a <- Auth(platform = "cavatica", token = "d8554e151de14d9b998af569994f4bfb")
p <- a$project(id = "gaonkark/sv-test")
file <- p$file(name = basename(input_txt), exact = TRUE)
merged$Tumor_Sample_Barcode <- file$meta()$`Kids First Biospecimen ID`
merged <- cbind( merged[,(1:3)], merged[,(103:105)], merged[,4:102] )
names(merged)[names(merged)== "ANN.0..EFFECT"] <- "Variant_Classification"
names(merged)[names(merged)== "REF"] <- "Reference_Allele"
names(merged)[names(merged)== "ALT"] <- "Tumor_Seq_Allele2"
merged <- merged %>% separate_rows(Variant_Classification, sep = "&")
write.table(merged, output_txt, sep = "\t", quote = F, row.names = F)
# merged$Variant_Classification[merged$Variant_Classification == "missense_variant"] <- "Missense_Mutation"
# merged$Variant_Classification[merged$Variant_Classification == "protein_protein_contact"] <- "Missense_Mutation"
# merged$Variant_Classification[merged$Variant_Classification == "stop_gained"] <- "Nonsense_Mutation"
# merged$Variant_Classification[merged$Variant_Classification == "start_lost"] <- "Translational_Start_Site"
# merged$Variant_Classification[merged$Variant_Classification == "splice_donor_variant"] <- "Splice_Site"
# merged$Variant_Classification[merged$Variant_Classification == "splice_acceptor_variant"] <- "Splice_Site"
# merged$Variant_Classification[(merged$Variant_Classification == "conservative_inframe_deletion") | (merged$Variant_Classification == "disruptive_inframe_deletion")] <- "In_Frame_Del"
# merged$Variant_Classification[(merged$Variant_Classification == "conservative_inframe_insertion") | (merged$Variant_Classification == "disruptive_inframe_insertion")] <- "In_Frame_Ins"
# merged$Variant_Classification[(merged$Variant_Classification == "frameshift_variant") & (merged$Variant_Type == "INS")] <- "Frame_Shift_Ins"
# merged$Variant_Classification[(merged$Variant_Classification == "frameshift_variant") & (merged$Variant_Type == "DEL")] <- "Frame_Shift_Del"
b <- merged
c <- merged
source('~/Desktop/filter/dbnsfp filter.R')
source('~/Desktop/filter/dbnsfp_filter.R')
input_txt <- "5cde2a06-cf00-4702-b8c1-7a2153a8afd1.snpeff.dbnsfp_anno.txt"
input_genes <- "predisposition-genes.txt"
threshold <- 0.001
output_txt <- sub(".snpEff.vcf.dbnsfp_anno.txt",".snpEff.dbnsfp_anno.filt.txt", basename(input_txt))
print(output_txt)
#read input
input <- read.delim(input_txt, sep = "\t", comment.char = "#", stringsAsFactors = F)
print("input txt read")
View(d)
source('~/Desktop/filter/dbnsfp_filter.R')
source('~/Desktop/filter/dbnsfp_filter.R')
first <- merged
View(first)
source('~/Desktop/filter/dbnsfp_filter.R')
input_txt <- "210ffa9f-c1d9-4ea4-b46c-f3e1e4ae58cc.snpeff.dbnsfp_anno.txt"
input_genes <- "predisposition-genes.txt"
threshold <- 0.001
output_txt <- sub(".snpEff.vcf.dbnsfp_anno.txt",".snpEff.dbnsfp_anno.filt.txt", basename(input_txt))
print(output_txt)
#read input
input <- read.delim(input_txt, sep = "\t", comment.char = "#", stringsAsFactors = F)
print("input txt read")
df <- as.data.frame(input)
print("input txt converted to df")
rm(input)
#pass filter
passfilter <- df[grep("pass", df$FILTER, ignore.case = T),]
rm(df)
genes <- read.delim(input_genes, header = F, sep = "", stringsAsFactors = F)
#check against genes
genefilter <- passfilter[is.element(passfilter$ANN.0..GENE.,genes$V1), ]
rm(passfilter)
qfilter <- genefilter[grep("high|moderate",
genefilter$ANN.0..IMPACT., ignore.case = T),]
#check against threshold
qfilter[71:102] <- sapply(qfilter[71:102],as.numeric)
thresholdfilter <- qfilter[apply((qfilter[,71:102] <= threshold) | (is.na(qfilter[,71:102])), 1, all),]
rm(genefilter)
rm(qfilter)
rm(genes)
#keep SIFT predictions
siftfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_SIFT_pred, ignore.case = TRUE),]
sift4Gfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_SIFT4G_pred, ignore.case = TRUE),]
lrtfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_LRT_pred, ignore.case = TRUE),]
muttfilter <- thresholdfilter[grep("A|D", thresholdfilter$dbNSFP_MutationTaster_pred, ignore.case = TRUE),]
pphdivfilter <- thresholdfilter[grep("D|P", thresholdfilter$dbNSFP_Polyphen2_HDIV_pred, ignore.case = TRUE),]
pphvarfilter <- thresholdfilter[grep("D|P", thresholdfilter$dbNSFP_Polyphen2_HVAR_pred, ignore.case = TRUE),]
metasvmfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_MetaSVM_pred, ignore.case = TRUE),]
metalrfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_MetaLR_pred, ignore.case = TRUE),]
mcapfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_M_CAP_pred, ignore.case = TRUE),]
primateaifilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_PrimateAI_pred, ignore.case = TRUE),]
fathmmfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_FATHMM_pred, ignore.case = TRUE),]
proveanfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_PROVEAN_pred, ignore.case = TRUE),]
mutafilter <- thresholdfilter[grep("H|M", thresholdfilter$dbNSFP_MutationAssessor_pred, ignore.case = TRUE),]
aloftfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_Aloft_pred, ignore.case = TRUE),]
deogenfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_DEOGEN2_pred, ignore.case = TRUE),]
clinvarfilter <- thresholdfilter[grep("pathogenic", thresholdfilter$dbNSFP_clinvar_clnsig, ignore.case = T),]
merged <- rbind(clinvarfilter, siftfilter, sift4Gfilter,lrtfilter,muttfilter,pphdivfilter,pphvarfilter,metasvmfilter,metalrfilter,mcapfilter,primateaifilter,fathmmfilter,proveanfilter,mutafilter,aloftfilter,deogenfilter)
merged <- unique(merged)
names(merged)[names(merged)== "ANN.0..GENE."] <- "Hugo_Symbol"
names(merged)[names(merged)== "CHROM"] <- "Chromosome"
names(merged)[names(merged)== "POS"] <- "Start_Position"
for (i in 1:nrow(merged)) {
merged$End_Position[i] <- merged$Start_Position[i] + max(unlist(lapply(as.list(unlist(strsplit(merged$ALT[i], ","))), nchar))) - nchar(merged$REF[i])
startpos <- merged$Start_Position[i]
endpos <- merged$End_Position[i]
if(endpos-startpos > 0) {
merged$Variant_Type[i] <- "INS"
} else if (endpos-startpos < 0) {
merged$Variant_Type[i] <- "DEL"
} else {
merged$Variant_Type[i] <- "SNP"
}
}
a <- Auth(platform = "cavatica", token = "d8554e151de14d9b998af569994f4bfb")
p <- a$project(id = "gaonkark/sv-test")
file <- p$file(name = basename(input_txt), exact = TRUE)
merged$Tumor_Sample_Barcode <- file$meta()$`Kids First Biospecimen ID`
merged <- cbind( merged[,(1:3)], merged[,(103:105)], merged[,4:102] )
names(merged)[names(merged)== "ANN.0..EFFECT"] <- "Variant_Classification"
names(merged)[names(merged)== "REF"] <- "Reference_Allele"
names(merged)[names(merged)== "ALT"] <- "Tumor_Seq_Allele2"
merged <- merged %>% separate_rows(Variant_Classification, sep = "&")
# merged$Variant_Classification[merged$Variant_Classification == "missense_variant"] <- "Missense_Mutation"
# merged$Variant_Classification[merged$Variant_Classification == "protein_protein_contact"] <- "Missense_Mutation"
# merged$Variant_Classification[merged$Variant_Classification == "stop_gained"] <- "Nonsense_Mutation"
# merged$Variant_Classification[merged$Variant_Classification == "start_lost"] <- "Translational_Start_Site"
# merged$Variant_Classification[merged$Variant_Classification == "splice_donor_variant"] <- "Splice_Site"
# merged$Variant_Classification[merged$Variant_Classification == "splice_acceptor_variant"] <- "Splice_Site"
# merged$Variant_Classification[(merged$Variant_Classification == "conservative_inframe_deletion") | (merged$Variant_Classification == "disruptive_inframe_deletion")] <- "In_Frame_Del"
# merged$Variant_Classification[(merged$Variant_Classification == "conservative_inframe_insertion") | (merged$Variant_Classification == "disruptive_inframe_insertion")] <- "In_Frame_Ins"
# merged$Variant_Classification[(merged$Variant_Classification == "frameshift_variant") & (merged$Variant_Type == "INS")] <- "Frame_Shift_Ins"
# merged$Variant_Classification[(merged$Variant_Classification == "frameshift_variant") & (merged$Variant_Type == "DEL")] <- "Frame_Shift_Del"
write.table(merged, output_txt, sep = "\t", quote = F, row.names = F)
third <- merged
input_txt <- "e3d780ba-97fb-46c1-8224-9faa7912c67d.snpeff.dbnsfp_anno.txt"
input_genes <- "predisposition-genes.txt"
threshold <- 0.001
output_txt <- sub(".snpEff.vcf.dbnsfp_anno.txt",".snpEff.dbnsfp_anno.filt.txt", basename(input_txt))
print(output_txt)
#read input
input <- read.delim(input_txt, sep = "\t", comment.char = "#", stringsAsFactors = F)
print("input txt read")
df <- as.data.frame(input)
print("input txt converted to df")
rm(input)
#pass filter
passfilter <- df[grep("pass", df$FILTER, ignore.case = T),]
rm(df)
genes <- read.delim(input_genes, header = F, sep = "", stringsAsFactors = F)
#check against genes
genefilter <- passfilter[is.element(passfilter$ANN.0..GENE.,genes$V1), ]
rm(passfilter)
qfilter <- genefilter[grep("high|moderate",
genefilter$ANN.0..IMPACT., ignore.case = T),]
#check against threshold
qfilter[71:102] <- sapply(qfilter[71:102],as.numeric)
thresholdfilter <- qfilter[apply((qfilter[,71:102] <= threshold) | (is.na(qfilter[,71:102])), 1, all),]
rm(genefilter)
rm(qfilter)
rm(genes)
#keep SIFT predictions
siftfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_SIFT_pred, ignore.case = TRUE),]
sift4Gfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_SIFT4G_pred, ignore.case = TRUE),]
lrtfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_LRT_pred, ignore.case = TRUE),]
muttfilter <- thresholdfilter[grep("A|D", thresholdfilter$dbNSFP_MutationTaster_pred, ignore.case = TRUE),]
pphdivfilter <- thresholdfilter[grep("D|P", thresholdfilter$dbNSFP_Polyphen2_HDIV_pred, ignore.case = TRUE),]
pphvarfilter <- thresholdfilter[grep("D|P", thresholdfilter$dbNSFP_Polyphen2_HVAR_pred, ignore.case = TRUE),]
metasvmfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_MetaSVM_pred, ignore.case = TRUE),]
metalrfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_MetaLR_pred, ignore.case = TRUE),]
mcapfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_M_CAP_pred, ignore.case = TRUE),]
primateaifilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_PrimateAI_pred, ignore.case = TRUE),]
fathmmfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_FATHMM_pred, ignore.case = TRUE),]
proveanfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_PROVEAN_pred, ignore.case = TRUE),]
mutafilter <- thresholdfilter[grep("H|M", thresholdfilter$dbNSFP_MutationAssessor_pred, ignore.case = TRUE),]
aloftfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_Aloft_pred, ignore.case = TRUE),]
deogenfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_DEOGEN2_pred, ignore.case = TRUE),]
clinvarfilter <- thresholdfilter[grep("pathogenic", thresholdfilter$dbNSFP_clinvar_clnsig, ignore.case = T),]
merged <- rbind(clinvarfilter, siftfilter, sift4Gfilter,lrtfilter,muttfilter,pphdivfilter,pphvarfilter,metasvmfilter,metalrfilter,mcapfilter,primateaifilter,fathmmfilter,proveanfilter,mutafilter,aloftfilter,deogenfilter)
merged <- unique(merged)
names(merged)[names(merged)== "ANN.0..GENE."] <- "Hugo_Symbol"
names(merged)[names(merged)== "CHROM"] <- "Chromosome"
names(merged)[names(merged)== "POS"] <- "Start_Position"
for (i in 1:nrow(merged)) {
merged$End_Position[i] <- merged$Start_Position[i] + max(unlist(lapply(as.list(unlist(strsplit(merged$ALT[i], ","))), nchar))) - nchar(merged$REF[i])
startpos <- merged$Start_Position[i]
endpos <- merged$End_Position[i]
if(endpos-startpos > 0) {
merged$Variant_Type[i] <- "INS"
} else if (endpos-startpos < 0) {
merged$Variant_Type[i] <- "DEL"
} else {
merged$Variant_Type[i] <- "SNP"
}
}
a <- Auth(platform = "cavatica", token = "d8554e151de14d9b998af569994f4bfb")
p <- a$project(id = "gaonkark/sv-test")
file <- p$file(name = basename(input_txt), exact = TRUE)
merged$Tumor_Sample_Barcode <- file$meta()$`Kids First Biospecimen ID`
merged <- cbind( merged[,(1:3)], merged[,(103:105)], merged[,4:102] )
names(merged)[names(merged)== "ANN.0..EFFECT"] <- "Variant_Classification"
names(merged)[names(merged)== "REF"] <- "Reference_Allele"
names(merged)[names(merged)== "ALT"] <- "Tumor_Seq_Allele2"
merged <- merged %>% separate_rows(Variant_Classification, sep = "&")
fourth <- merged
input_txt <- "e3d780ba-97fb-46c1-8224-9faa7912c67d.snpeff.dbnsfp_anno.txt"
input_genes <- "predisposition-genes.txt"
threshold <- 0.001
output_txt <- sub(".snpEff.dbnsfp_anno.txt",".snpEff.dbnsfp_anno.filt.txt", basename(input_txt))
print(output_txt)
input_txt <- "e3d780ba-97fb-46c1-8224-9faa7912c67d.snpeff.dbnsfp_anno.txt"
input_genes <- "predisposition-genes.txt"
threshold <- 0.001
output_txt <- sub("snpeff.dbnsfp_anno","snpEff.dbnsfp_anno.filt", basename(input_txt))
print(output_txt)
library(tidyverse)
library(sevenbridges)
args = commandArgs(trailingOnly = TRUE)
input_txt <- "e3d780ba-97fb-46c1-8224-9faa7912c67d.snpeff.dbnsfp_anno.txt"
input_genes <- "predisposition-genes.txt"
threshold <- 0.001
output_txt <- sub("snpeff.dbnsfp_anno","snpEff.dbnsfp_anno.filt", basename(input_txt))
print(output_txt)
#read input
input <- read.delim(input_txt, sep = "\t", comment.char = "#", stringsAsFactors = F)
print("input txt read")
df <- as.data.frame(input)
print("input txt converted to df")
rm(input)
#pass filter
passfilter <- df[grep("pass", df$FILTER, ignore.case = T),]
rm(df)
genes <- read.delim(input_genes, header = F, sep = "", stringsAsFactors = F)
#check against genes
genefilter <- passfilter[is.element(passfilter$ANN.0..GENE.,genes$V1), ]
rm(passfilter)
qfilter <- genefilter[grep("high|moderate",
genefilter$ANN.0..IMPACT., ignore.case = T),]
#check against threshold
qfilter[71:102] <- sapply(qfilter[71:102],as.numeric)
thresholdfilter <- qfilter[apply((qfilter[,71:102] <= threshold) | (is.na(qfilter[,71:102])), 1, all),]
rm(genefilter)
rm(qfilter)
rm(genes)
#keep SIFT predictions
siftfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_SIFT_pred, ignore.case = TRUE),]
sift4Gfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_SIFT4G_pred, ignore.case = TRUE),]
lrtfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_LRT_pred, ignore.case = TRUE),]
muttfilter <- thresholdfilter[grep("A|D", thresholdfilter$dbNSFP_MutationTaster_pred, ignore.case = TRUE),]
pphdivfilter <- thresholdfilter[grep("D|P", thresholdfilter$dbNSFP_Polyphen2_HDIV_pred, ignore.case = TRUE),]
pphvarfilter <- thresholdfilter[grep("D|P", thresholdfilter$dbNSFP_Polyphen2_HVAR_pred, ignore.case = TRUE),]
metasvmfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_MetaSVM_pred, ignore.case = TRUE),]
metalrfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_MetaLR_pred, ignore.case = TRUE),]
mcapfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_M_CAP_pred, ignore.case = TRUE),]
primateaifilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_PrimateAI_pred, ignore.case = TRUE),]
fathmmfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_FATHMM_pred, ignore.case = TRUE),]
proveanfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_PROVEAN_pred, ignore.case = TRUE),]
mutafilter <- thresholdfilter[grep("H|M", thresholdfilter$dbNSFP_MutationAssessor_pred, ignore.case = TRUE),]
aloftfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_Aloft_pred, ignore.case = TRUE),]
deogenfilter <- thresholdfilter[grep("D", thresholdfilter$dbNSFP_DEOGEN2_pred, ignore.case = TRUE),]
clinvarfilter <- thresholdfilter[grep("pathogenic", thresholdfilter$dbNSFP_clinvar_clnsig, ignore.case = T),]
merged <- rbind(clinvarfilter, siftfilter, sift4Gfilter,lrtfilter,muttfilter,pphdivfilter,pphvarfilter,metasvmfilter,metalrfilter,mcapfilter,primateaifilter,fathmmfilter,proveanfilter,mutafilter,aloftfilter,deogenfilter)
merged <- unique(merged)
names(merged)[names(merged)== "ANN.0..GENE."] <- "Hugo_Symbol"
names(merged)[names(merged)== "CHROM"] <- "Chromosome"
names(merged)[names(merged)== "POS"] <- "Start_Position"
for (i in 1:nrow(merged)) {
merged$End_Position[i] <- merged$Start_Position[i] + max(unlist(lapply(as.list(unlist(strsplit(merged$ALT[i], ","))), nchar))) - nchar(merged$REF[i])
startpos <- merged$Start_Position[i]
endpos <- merged$End_Position[i]
if(endpos-startpos > 0) {
merged$Variant_Type[i] <- "INS"
} else if (endpos-startpos < 0) {
merged$Variant_Type[i] <- "DEL"
} else {
merged$Variant_Type[i] <- "SNP"
}
}
a <- Auth(platform = "cavatica", token = "d8554e151de14d9b998af569994f4bfb")
p <- a$project(id = "gaonkark/sv-test")
file <- p$file(name = basename(input_txt), exact = TRUE)
merged$Tumor_Sample_Barcode <- file$meta()$`Kids First Biospecimen ID`
merged <- cbind( merged[,(1:3)], merged[,(103:105)], merged[,4:102] )
names(merged)[names(merged)== "ANN.0..EFFECT"] <- "Variant_Classification"
names(merged)[names(merged)== "REF"] <- "Reference_Allele"
names(merged)[names(merged)== "ALT"] <- "Tumor_Seq_Allele2"
merged <- merged %>% separate_rows(Variant_Classification, sep = "&")
# merged$Variant_Classification[merged$Variant_Classification == "missense_variant"] <- "Missense_Mutation"
# merged$Variant_Classification[merged$Variant_Classification == "protein_protein_contact"] <- "Missense_Mutation"
# merged$Variant_Classification[merged$Variant_Classification == "stop_gained"] <- "Nonsense_Mutation"
# merged$Variant_Classification[merged$Variant_Classification == "start_lost"] <- "Translational_Start_Site"
# merged$Variant_Classification[merged$Variant_Classification == "splice_donor_variant"] <- "Splice_Site"
# merged$Variant_Classification[merged$Variant_Classification == "splice_acceptor_variant"] <- "Splice_Site"
# merged$Variant_Classification[(merged$Variant_Classification == "conservative_inframe_deletion") | (merged$Variant_Classification == "disruptive_inframe_deletion")] <- "In_Frame_Del"
# merged$Variant_Classification[(merged$Variant_Classification == "conservative_inframe_insertion") | (merged$Variant_Classification == "disruptive_inframe_insertion")] <- "In_Frame_Ins"
# merged$Variant_Classification[(merged$Variant_Classification == "frameshift_variant") & (merged$Variant_Type == "INS")] <- "Frame_Shift_Ins"
# merged$Variant_Classification[(merged$Variant_Classification == "frameshift_variant") & (merged$Variant_Type == "DEL")] <- "Frame_Shift_Del"
write.table(merged, output_txt, sep = "\t", quote = F, row.names = F)
